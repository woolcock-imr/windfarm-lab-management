
<div id=D__ID>
    <section id=form_container__ID>
        <div id=header__ID>
            Neurotology - Vestibular Evoked Myogenic Potentials (VEMPs)
        </div>
        <form id=F__ID>
            <div class="container">
                <!-- participant part for all task forms -------------------->
                <div class="row row__ID" id=row_participant__ID>
                    <div class="col-sm-12 col-lg-9 input__ID">
                        <span class=label__ID>Participant</span><br>
                        <input type=text name="Participant" class=form-control id=Participant__ID data-id="Participant" required />
                    </div>
                    <div class="col-sm-12 col-lg-3 input__ID">
                        <span class=label__ID>Participant ID</span><br>
                        <input type=text name="Participant_uid" class=form-control readonly />
                    </div>
                    <hr style="border-top: 1px solid #888;width: 100%;margin:10px 0">
                </div>
                <!---------------------------------------------------->
                <!-- Form Inputs-------------------------------------->
      
                <div id=dynamic_part__ID></div>
           
            <div class='row row__ID'>
                <div class="col">
                    <span>VEMP Comments</span>
                    <div class="form-control">
                        <u style='cursor:pointer' id=link_comments__ID></u>
                        <br>
                        <input type="datalist" name=comments style="margin-top:6px;width:600px" /> &nbsp&nbsp&nbsp 
                    </div>
                </div>
            </div>
            <div class='row row__ID'>
                <div class="col">
                    <span>VEMP Upload </span>
                    <div class="form-control">
                        <u style='cursor:pointer' id=link_vemp_upload__ID></u>
                        <br>
                        <input type="file" name=vemp_upload style="margin-top:6px" /> &nbsp&nbsp&nbsp <button type="button"
                            id=vemp_upload__ID>Remove</button>
                    </div>
                </div>
            </div>



                <!---------------------------------------------------->
                <!-- submit button part for all tsak forms------------>
                <br>
                <div class="row">
                    <div class=col>
                        <button id=submit__ID type="submit" class="btn btn-secondary">Submit</button>
                    </div>
                </div>
                <!---------------------------------------------------->
            </div>
        </form>
    </section>
    VmInclude:__COMPONENT__/m/model.01.html
    <script>
        function F__ID(){
            //-------------------------------------
            //build text input fields
            var fields ="Visit,R_AC_cVEMP_p13_latency,R_AC_cVEMP_n23_latency,R_AC_cVEMP_pp_AMP,R_AC_cVemp_rectified_activation,R_AC_cVEMP_Activation,R_AC_cVEMP_CA,L_AC_cVEMP_p13_latency,L_AC_cVEMP_n23_latency,L_AC_cVEMP_pp_AMP,L_AC_cVemp_rectified_activation,L_AC_cVEMP_Activation,L_AC_cVEMP_CA,AC_cVEMP_AR,R_BC_cVEMP_p13_latency,R_BC_cVEMP_n23_latency,R_BC_cVEMP_pp_AMP,R_BC_cVemp_rectified_activation,R_BC_cVEMP_Activation,R_BC_cVEMP_CA,L_BC_cVEMP_p13_latency,L_BC_cVEMP_n23_latency,L_BC_cVEMP_pp_AMP,L_BC_cVemp_rectified_activation,L_BC_cVEMP_Activation,L_BC_cVEMP_CA,BC_cVEMP_AR,R_AC_oVEMP_n10_Latency,R_AC_oVEMP_pp_Amp,L_AC_oVEMP_n10_Latency,L_AC_oVEMP_pp_AMP,AC_oVEMP_AR,R_BC_oVEMP_n10_Latency,R_BC_oVEMP_pp_Amp,L_BC_oVEMP_n10_Latency,L_BC_oVEMP_pp_Amp,BC_oVMEP_AR,comments,vemp_upload";
            var fs=fields.split(',');
            var txt="";
            for(var i=0;i<fs.length;i++){
                txt+="<div class='row row__ID'><div class='col'>\r\n";
                txt+="<span>"+fs[i].replace(/_/g,"")+"</span><input type=text class=form-control name="+fs[i]+">\r\n";
                txt+="</div></div>\r\n";
            }
            $('#dynamic_part__ID').html(txt);
            //-------------------------------------
            VmInclude:__COMPONENT__/f/form.01.js
            VmInclude:'__CURRENT_PATH__/task-form.js'
            //-------------------------------------
            var load5=m.load;
            m.load=function(){
                load5();
                 m.set_file_link("vemp_upload");
                //---------------------------------------
                var custom_field_process=function(){
                    $('#tb__ID td[data-custom=1]').each(function(){
                        var field=$(this).attr('data-id');
                        switch(field){
                            case"Participant":
                                $(this).find("input[name='"+field+"']").val(_records[I].Participant);
                                $(this).find("input[name='"+field+"_uid']").val(_records[I].Participant_uid);
                            break;
                            case "R_AC_cVEMP_p13_latency":
                            case "R_AC_cVEMP_n23_latency":
                            case "R_AC_cVEMP_pp_AMP":
                            case "R_AC_cVemp_rectified_activation":
                            case "R_AC_cVEMP_Activation":
                            case "R_AC_cVEMP_CA":
                            case "L_AC_cVEMP_p13_latency":
                            case "L_AC_cVEMP_n23_latency":
                            case "L_AC_cVEMP_pp_AMP":
                            case "L_AC_cVemp_rectified_activation":
                            case "L_AC_cVEMP_Activation":
                            case "L_AC_cVEMP_CA":
                            case "AC_cVEMP_AR":
                            case "R_BC_cVEMP_p13_latency":
                            case "R_BC_cVEMP_n23_latency":
                            case "R_BC_cVEMP_pp_AMP":
                            case "R_BC_cVemp_rectified_activation":
                            case "R_BC_cVEMP_Activation":
                            case "R_BC_cVEMP_CA":
                            case "L_BC_cVEMP_p13_latency":
                            case "L_BC_cVEMP_n23_latency":
                            case "L_BC_cVEMP_pp_AMP":
                            case "L_BC_cVemp_rectified_activation":
                            case "L_BC_cVEMP_Activation":
                            case "L_BC_cVEMP_CA":
                            case "BC_cVEMP_AR":
                            case "R_AC_oVEMP_n10_Latency":
                            case "R_AC_oVEMP_pp_Amp":
                            case "L_AC_oVEMP_n10_Latency":
                            case "L_AC_oVEMP_pp_AMP":
                            case "AC_oVEMP_AR":
                            case "R_BC_oVEMP_n10_Latency":
                            case "R_BC_oVEMP_pp_Amp":
                            case "L_BC_oVEMP_n10_Latency":
                            case "L_BC_oVEMP_pp_Amp":
                            case "BC_oVMEP_AR":

                            $(this).parent().find("input[name='"+field+"'][value='"+_records[I][field]+"']").prop('checked', true);
                            $(this).parent().find("input[name='"+field+"']").on('click',function(){

                                    _set_value(this.value,_records,I,field);
                                })
                            break;
                        }
                    })
                }
                //----------------------------------

                var old_before_submit=m.before_submit;
                m.before_submit=function(record,dbv){
                    old_before_submit(record,dbv);
                 
    
                    record['R_AC_cVEMP_Activation']=(record['R_AC_cVemp_rectified_activation']/20).toFixed(4);
                    record['R_AC_cVEMP_CA']=(record['R_AC_cVEMP_pp_AMP']/record['R_AC_cVEMP_Activation']).toFixed(4);
                    record['L_AC_cVEMP_Activation']=(record['L_AC_cVemp_rectified_activation']/20).toFixed(4);
                    record['L_AC_cVEMP_CA']=(record['L_AC_cVEMP_pp_AMP']/record['L_AC_cVEMP_Activation']).toFixed(4);
                    record['AC_cVEMP_AR']=((parseFloat(record['L_AC_cVEMP_CA'])-parseFloat(record['R_AC_cVEMP_CA']))/(parseFloat(record['L_AC_cVEMP_CA'])+parseFloat(record['R_AC_cVEMP_CA']))*100).toFixed(4);
                    record['R_BC_cVEMP_Activation']=(record['R_BC_cVemp_rectified_activation']/20).toFixed(4);
                    record['R_BC_cVEMP_CA']=(record['R_BC_cVEMP_pp_AMP']/record['R_BC_cVEMP_Activation']).toFixed(4);
                    if(record['R_BC_cVEMP_CA']=='NaN') record['R_BC_cVEMP_CA']='';
                    record['L_BC_cVEMP_Activation']=(record['L_BC_cVemp_rectified_activation']/20).toFixed(4);
                    record['L_BC_cVEMP_CA']=(record['L_BC_cVEMP_pp_AMP']/record['L_BC_cVEMP_Activation']).toFixed(4);
                    if (record['L_BC_cVEMP_CA'] == 'NaN') record['L_BC_cVEMP_CA'] = '';
                    record['BC_cVEMP_AR']=((parseFloat(record['L_BC_cVEMP_CA'])-parseFloat(record['R_BC_cVEMP_CA']))/(parseFloat(record['L_BC_cVEMP_CA'])+parseFloat(record['R_BC_cVEMP_CA']))*100).toFixed(4);
                    if (record['BC_cVEMP_AR'] == 'NaN') record['BC_cVEMP_AR'] = '';
                    record['AC_oVEMP_AR']=((parseFloat(record['L_AC_oVEMP_pp_AMP'])-parseFloat(record['R_AC_oVEMP_pp_Amp']))/ (parseFloat(record['L_AC_oVEMP_pp_AMP'])+ parseFloat(record['R_AC_oVEMP_pp_Amp']))*100).toFixed(4);
                    if (record['AC_oVEMP_AR'] == 'NaN') record['AC_oVEMP_AR'] = '';
                    record['BC_oVMEP_AR']=((parseFloat(record['L_BC_oVEMP_pp_Amp'])-parseFloat(record['R_BC_oVEMP_pp_Amp']))/ (parseFloat(record['L_BC_oVEMP_pp_Amp'])+ parseFloat(record['R_BC_oVEMP_pp_Amp']))*100).toFixed(4);
                    if (record['BC_oVMEP_AR'] == 'NaN') record['BC_oVMEP_AR'] = '';

                    return true;
                };
                //-------------------------------------
            } 
        }    

    </script>
    <style>
        #form_container__ID{
            max-width:700px;
        }
        VmInclude:__COMPONENT__/f/form.01.css
        
    </style>
</div>
